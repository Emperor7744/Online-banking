"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8773,9833],{81580:(e,t,r)=>{r.d(t,{Dp:()=>f,Ez:()=>i,eJ:()=>u,kd:()=>p});var a=r(54857),n=r(96541),o=r(99756),s=r(96950),l=r(97682),d=r(84930);let i={duration:.35,ease:[.35,.2,.14,.95]},c={x:0,y:0,z:0,rotate:0,scale:1,skew:0,opacity:1};function u(e){let{children:t,preventAnimation:r=!1}=e;return(0,a.jsx)(l.P.span,{animate:{opacity:1},initial:{opacity:r?1:0},children:t})}function f(e){let{children:t,variants:r,transition:u}=e,{ref:f,controls:p,fullVariants:m}=function(e,t,r){let a=(0,o.I)(),l=(0,n.useContext)(d.w),u=(0,s.E)(),f=(0,n.useRef)(null),p=(0,n.useRef)("idle"),m=(0,n.useRef)(!1),I=(0,n.useRef)(!1),g=(0,n.useMemo)(()=>({idle:{...c,...t.idle},hover:{...c,...t.hover},tap:{...c,...t.tap}}),[t]),h=(0,n.useCallback)(async e=>{let t=g[p.current],a=g[e];if(m.current&&!1===t.interruptible||I.current||e===p.current&&m.current)return;m.current=!0;let n=p.current;p.current=e;try{await u.start({...a,transition:a.transition||r||i})}catch(e){p.current=n}finally{if(m.current=!1,a.after&&p.current===e){let{state:e,delay:t=0}=a.after;I.current=!0,setTimeout(()=>{I.current=!1,h(e)},1e3*t)}else p.current!==e&&h(p.current)}},[u,r,g]);return(0,n.useEffect)(()=>{if(!l||a)return;let t=function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t?"BUTTON"===t.tagName||"A"===t.tagName?t:r>10?(console.warn("Animated Icon can't find valid parent element (<button> or <a>) after 10 iterations. Falling back to root element."),null):e(t.parentElement,r+1):null}(f.current);if(t)return l.registerIcon(e,{parent:t,transitionTo:h}),()=>{l.unregisterIcon(e)}},[]),{ref:f,controls:u,fullVariants:g}}((0,n.useRef)(Math.random().toString(36).substr(2,9)).current,r,u);return(0,a.jsx)(l.P.span,{animate:p,className:"transition-none",initial:"idle",ref:f,variants:m,children:t})}function p(e){let{children:t,hideOverflow:r}=e;return(0,a.jsx)("span",{className:"grid [&>*]:[grid-area:1/1] ".concat(r?"overflow-hidden":""),children:t})}},84930:(e,t,r)=>{r.d(t,{AnimatedIconProvider:()=>s,w:()=>o});var a=r(54857),n=r(96541);let o=(0,n.createContext)(null);function s(e){let{children:t}=e,[r,s]=(0,n.useState)(()=>new Map),l=(0,n.useRef)(null),d=(0,n.useCallback)(e=>{let t=e.target;r.forEach((r,a)=>{if(r.parent.contains(t))switch(e.type){case"mouseover":l.current!==a&&(l.current=a,r.transitionTo("hover"));break;case"mouseout":r.parent.contains(e.relatedTarget)||(l.current=null,r.transitionTo("idle"));break;case"mousedown":r.transitionTo("tap");break;case"mouseup":r.transitionTo(l.current===a?"hover":"idle")}else"mouseover"===e.type&&l.current===a&&(l.current=null,r.transitionTo("idle"))})},[r]);(0,n.useEffect)(()=>(window.addEventListener("mouseover",d,!0),window.addEventListener("mouseout",d,!0),window.addEventListener("mousedown",d,!0),window.addEventListener("mouseup",d,!0),()=>{window.removeEventListener("mouseover",d,!0),window.removeEventListener("mouseout",d,!0),window.removeEventListener("mousedown",d,!0),window.removeEventListener("mouseup",d,!0)}),[d]);let i=(0,n.useCallback)((e,t)=>{s(r=>new Map(r).set(e,t))},[]),c=(0,n.useCallback)(e=>{s(t=>{let r=new Map(t);return r.delete(e),r})},[]);return(0,a.jsx)(o.Provider,{value:{registerIcon:i,unregisterIcon:c},children:t})}},56527:(e,t,r)=>{r.d(t,{T:()=>o});var a=r(54857),n=r(37622);function o(e){let{size:t=16,className:r}=e;return(0,a.jsxs)("svg",{className:(0,n.cn)("copy-icon overflow-visible",r),fill:"currentColor",height:t,viewBox:"0 0 16 16",width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("style",{children:'.copy-icon {\n            * {\n              transition: transform 0.35s cubic-bezier(0.35, 0.2, 0.14, 0.95), d 0.35s cubic-bezier(0.35, 0.2, 0.14, 0.95);\n            }\n          }\n          button:has(.copy-icon):hover, button:has(.copy-icon):focus-visible {\n            .left {\n              d: path("M 2.75 0.5 C 1.7835 0.5 1 1.2835 1 2.25 V 9.75 C 1 10.7165 1.7835 11.5 2.75 11.5 H 3.75 H 6.5 V 10 H 3.75 H 2.75 C 2.6119 10 2.5 9.8881 2.5 9.75 V 2.25 C 2.5 2.1119 2.6119 2 2.75 2 H 8.25 C 8.3881 2 8.5 2.1119 8.5 2.25 V 5 H 10 V 2.25 C 10 1.2835 9.2165 0.5 8.25 0.5 H 2.75 Z");\n              transform: translate(-1px, -1px);\n            }\n            .right {\n              transform: translate(1px, 1px);\n            }\n          }'}),(0,a.jsx)("path",{className:"left",clipRule:"evenodd",d:"M2.75 0.5C1.7835 0.5 1 1.2835 1 2.25V9.75C1 10.7165 1.7835 11.5 2.75 11.5H3.75H4.5V10H3.75H2.75C2.61193 10 2.5 9.88807 2.5 9.75V2.25C2.5 2.11193 2.61193 2 2.75 2H8.25C8.38807 2 8.5 2.11193 8.5 2.25V3H10V2.25C10 1.2835 9.2165 0.5 8.25 0.5H2.75Z",fill:"currentColor",fillRule:"evenodd"}),(0,a.jsx)("path",{className:"right",clipRule:"evenodd",d:"M7.75 4.5C6.7835 4.5 6 5.2835 6 6.25V13.75C6 14.7165 6.7835 15.5 7.75 15.5H13.25C14.2165 15.5 15 14.7165 15 13.75V6.25C15 5.2835 14.2165 4.5 13.25 4.5H7.75ZM7.5 6.25C7.5 6.11193 7.61193 6 7.75 6H13.25C13.3881 6 13.5 6.11193 13.5 6.25V13.75C13.5 13.8881 13.3881 14 13.25 14H7.75C7.61193 14 7.5 13.8881 7.5 13.75V6.25Z",fill:"currentColor",fillRule:"evenodd"})]})}},33744:(e,t,r)=>{r.d(t,{U:()=>d});var a=r(54857),n=r(2259),o=r(81580),s=r(56527),l=r(96541);function d(e){let{isCopied:t,size:r,className:d,customIcon:i}=e,[c,u]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{t&&u(!0)},[t]),(0,a.jsx)("span",{"aria-hidden":!0,className:d,children:(0,a.jsx)(o.kd,{children:t?(0,a.jsx)(o.eJ,{children:(0,a.jsx)(n.J,{size:r})},"check"):(0,a.jsx)(o.eJ,{preventAnimation:!c,children:i||(0,a.jsx)(s.T,{size:r})},"copy")})})}},45881:(e,t,r)=>{r.d(t,{Fc:()=>d,TN:()=>i});var a=r(54857),n=r(96541),o=r(99751),s=r(37622);let l=(0,o.F)("[&>svg]:text-foreground relative w-full rounded-lg border p-4 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=n.forwardRef((e,t)=>{let{className:r,variant:n,...o}=e;return(0,a.jsx)("div",{className:(0,s.cn)(l({variant:n}),r),ref:t,role:"alert",...o})});d.displayName="Alert",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h5",{className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",r),ref:t,...n})}).displayName="AlertTitle";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{className:(0,s.cn)("text-sm [&_p]:leading-relaxed",r),ref:t,...n})});i.displayName="AlertDescription"},86287:(e,t,r)=>{r.d(t,{p:()=>l});var a=r(54857),n=r(96541),o=r(37622);let s=(0,r(99751).F)("focus-visible:border-alpha-600 disabled:border-alpha-300 inline-flex w-full shrink-0 rounded-lg border bg-background px-3 py-1 text-sm outline-none transition-all file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-400 disabled:pointer-events-none disabled:cursor-not-allowed disabled:bg-gray-100 disabled:text-gray-400 disabled:ring-0",{variants:{size:{xs:"h-6",sm:"h-8",md:"h-10",lg:"h-12"}},defaultVariants:{size:"md"}}),l=n.forwardRef((e,t)=>{let{className:r,size:n,...l}=e;return l.suffix?(0,a.jsxs)("div",{className:"w-full flex text-sm rounded-lg border items-center justify-between focus-within:border-alpha-600",children:[(0,a.jsx)("input",{className:(0,o.cn)(s({size:n,className:r}),"flex-1 rounded-none rounded-l-lg focus-visible:none border-none"),ref:t,...l}),l.suffix]}):(0,a.jsx)("input",{className:(0,o.cn)(s({size:n,className:r})),ref:t,...l})});l.displayName="Input"},41773:(e,t,r)=>{r.d(t,{m:()=>d,r:()=>i});var a=r(96541),n=r(80612),o=r(43393),s=r(24048);function l(e,t){let{activeScopeSlug:r,user:l,isTeam:d}=(0,o.k6)(),{data:i,isLoading:c,mutate:u}=(0,n.Ay)(["chat:".concat(e),r],async t=>{let[,r]=t;if(!l||!r)return;let a="";if(d){let e=new URLSearchParams;e.set("team",r),a="?".concat(e.toString())}try{let t="history"===e?"/chat/api/history".concat(a):"/chat/api/favorites".concat(a),r=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to load chat ".concat(e));let n=await r.json();if(!n)throw Error("Failed to load chat ".concat(e));return n.map(e=>({...e,updatedAt:new Date(e.updatedAt)}))}catch(e){if(e==s.hB)return;throw e}},{fallbackData:t}),f=(0,a.useCallback)((e,t)=>{let r=e(i||[]);u(r,{optimisticData:r,revalidate:t})},[i,u]);return{data:i,isLoading:c,revalidate:(0,a.useCallback)(()=>u(),[u]),setData:f}}function d(e){return l("history",e)}function i(e){return l("favorites",e)}},34227:(e,t,r)=>{r.d(t,{C:()=>n});var a=r(96541);function n(e){let{timeout:t=2e3}=e,[r,n]=a.useState(!1);return{isCopied:r,copyToClipboard:async e=>{"writeText"in navigator.clipboard&&e&&(await navigator.clipboard.writeText(e),n(!0),setTimeout(()=>{n(!1)},t))}}}},9833:(e,t,r)=>{r.d(t,{Je:()=>S,PW:()=>E,bZ:()=>Q});var a=r(70540),n=r(4993),o=r(65017),s=r(67376),l=r(84837),d=r(10465),i=r(85669),c=r(81351),u=r(11334),f=r(40108),p=r(39179),m=r(27524),I=r(1402),g=r(82434),h=r(9224),v=r(33026),y=r(61702);function b(){let e=(0,a._)(["lower(",")"]);return b=function(){return e},e}let x={createdAt:(0,n.vE)("createdAt").defaultNow().notNull(),updatedAt:(0,n.vE)("updatedAt").defaultNow(),deletedAt:(0,n.vE)("deletedAt")},k=y.z.object({diff:y.z.string().optional(),originalCode:y.z.string(),findAndReplace:y.z.string().optional()});y.z.array(y.z.object({searchValue:y.z.string(),replaceValue:y.z.string()})),y.z.object({source:y.z.string().optional(),diffInfo:y.z.object({type:y.z.undefined(),...k.shape}).or(y.z.object({type:y.z.literal("multi-file"),fileToDiffMap:y.z.record(y.z.string(),k)})).optional(),remoteInfo:y.z.object({originalSources:y.z.record(y.z.string(),y.z.string()).optional(),accepted:y.z.boolean().optional()}).optional(),resultId:y.z.string().optional(),title:y.z.string().optional(),lang:y.z.string().optional(),meta:y.z.object({file:y.z.string().optional(),type:y.z.string().optional(),project:y.z.string().optional(),title:y.z.string().optional(),id:y.z.string().optional()}).optional(),env:y.z.array(y.z.object({target:y.z.array(y.z.string()),configurationId:y.z.string().optional(),comment:y.z.string().optional(),id:y.z.string(),key:y.z.string(),createdAt:y.z.number(),updatedAt:y.z.number(),createdBy:y.z.string(),updatedBy:y.z.string().optional(),type:y.z.string(),value:y.z.string()})).optional()}),y.z.object({title:y.z.string(),isMultiFile:y.z.boolean().optional(),remote:y.z.object({v:y.z.enum(["1"]),tunnel:y.z.string()}).optional(),from:y.z.string().optional(),isFigmaChat:y.z.boolean().optional(),context:y.z.object({ai:y.z.boolean().optional()}).optional()});let q=(0,o.cJ)("chats",{...x,chatId:(0,s.Qq)("chatId").primaryKey().notNull(),authorId:(0,s.Qq)("authorId").notNull(),ownerId:(0,s.Qq)("ownerId").notNull(),shareable:(0,l.zM)("shareable").notNull().default(!1),projectId:(0,s.Qq)("projectId").references(()=>z.projectId),metadata:(0,d.Fx)("metadata").$type(),summary:(0,s.Qq)("summary"),summaryLastMessageId:(0,s.Qq)("summaryLastMessageId"),currentLeafMessageId:(0,s.Qq)("currentLeafMessageId"),privacy:(0,s.Qq)("privacy").$type().default("private")},e=>({authorIdIndex:(0,i.Pe)("chatsAuthorIdIndex").on(e.authorId),projectIdIndex:(0,i.Pe)("chatsProjectIdIndex").on(e.projectId),ownerIdUpdatedAtIndex:(0,i.Pe)("chatsOwnerIdUpdatedAtIndex").on(e.ownerId,e.deletedAt.desc().nullsFirst(),e.updatedAt.desc()).concurrently()})),z=(0,o.cJ)("projects",{...x,projectId:(0,s.Qq)("projectId").primaryKey().notNull(),name:(0,s.Qq)("name").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("ownerId"),creatorId:(0,s.Qq)("creatorId").notNull(),settings:(0,d.Fx)("settings").$type(),privacy:(0,s.Qq)("privacy").$type().default("private"),vercelProjectId:(0,s.Qq)("vercelProjectId")},e=>({ownerIdIndex:(0,i.Pe)("projectsOwnerIdIndex").on(e.ownerId)}));(0,h.K1)(z,e=>{let{one:t,many:r}=e;return{chats:r(F),sources:r(T),hasUserFavoritedProject:t(L)}});let N=(0,o.cJ)("sources",{...x,sourceId:(0,s.Qq)("sourceId").primaryKey().notNull(),type:(0,s.Qq)("type").$type().notNull(),title:(0,s.Qq)("title"),description:(0,s.Qq)("description"),url:(0,s.Qq)("url"),content:(0,s.Qq)("content"),metadata:(0,d.Fx)("metadata").$type(),errorMessage:(0,s.Qq)("errorMessage"),status:(0,s.Qq)("status").$type().default("pending"),startedAt:(0,n.vE)("startedAt"),finishedAt:(0,n.vE)("finishedAt"),progress:(0,c.x)("progress").default(0),textContentUrl:(0,s.Qq)("textContentUrl")});(0,g.aJ)(N),(0,h.K1)(N,e=>{let{many:t}=e;return{projects:t(T),chats:t(J),messages:t(P)}}),(0,g.aJ)(q),(0,h.K1)(q,e=>{let{one:t,many:r}=e;return{messages:r(j),summaryLastMessage:t(j,{fields:[q.summaryLastMessageId],references:[j.messageId]}),blocks:r(C),sources:r(J),project:t(F),userFavoritedChats:t(_)}});let w=(0,u.rL)("messageType",["message","forked-block","forked-chat","open-in-v0","refinement","added-environment-variables","deleted-file","moved-file","renamed-file","edited-file","replace-src"]),Q=y.z.enum(["screenshot","figma"]).optional(),j=(0,o.cJ)("messages",{...x,messageId:(0,s.Qq)("messageId").primaryKey().notNull(),chatId:(0,s.Qq)("chatId").notNull().references(()=>q.chatId),content:(0,s.Qq)("content").notNull(),ragSources:(0,d.Fx)("sources").$type(),role:(0,f.yf)("role",{length:255}).notNull(),attachments:(0,d.Fx)("attachments").$type(),finishReason:(0,s.Qq)("finishReason").$type(),messageFeedback:(0,d.Fx)("messageFeedback").$type(),parentId:(0,s.Qq)("parentId"),type:w("type").notNull(),modelId:(0,s.Qq)("modelId").$type(),usage:(0,d.Fx)("usage").$type(),authorId:(0,s.Qq)("authorId").notNull(),metadata:(0,d.Fx)("metadata").$type()},e=>({chatIdIndex:(0,i.Pe)("messagesChatIdIndex").on(e.chatId),authorIdIndex:(0,i.Pe)("messagesAuthorIdIndex").on(e.authorId),createdAtIndex:(0,i.Pe)("messagesCreatedAtIndex").on(e.createdAt)}));(0,g.aJ)(j).shape.type,(0,h.K1)(j,e=>{let{one:t,many:r}=e;return{chat:t(q,{fields:[j.chatId],references:[q.chatId]}),blocks:r(C),feedback:r(K),parent:t(j,{fields:[j.parentId],references:[j.messageId]}),summary:t(A,{fields:[j.messageId],references:[A.messageId]}),sources:r(P)}});let A=(0,o.cJ)("chatMessageSummaries",{...x,chatId:(0,s.Qq)("chatId").notNull().references(()=>q.chatId),messageId:(0,s.Qq)("messageId").notNull().references(()=>j.messageId),content:(0,s.Qq)("content").notNull(),usage:(0,d.Fx)("usage").$type()},e=>({messageIdx:(0,i.Pe)("chatMessageSummariesMessageIdIndex").on(e.messageId),chatMessageUniqueIdx:(0,i.GL)("chatMessageSummariesUniqueIndex").on(e.chatId,e.messageId)}));(0,h.K1)(A,e=>{let{one:t}=e;return{chat:t(q,{fields:[A.chatId],references:[q.chatId]}),message:t(j,{fields:[A.messageId],references:[j.messageId]})}});let C=(0,o.cJ)("blocks",{...x,blockId:(0,s.Qq)("blockId").primaryKey().notNull(),blockType:(0,s.Qq)("blockType").notNull(),chatId:(0,s.Qq)("chatId").notNull().references(()=>q.chatId),messageId:(0,s.Qq)("messageId").notNull().references(()=>j.messageId),data:(0,d.Fx)("data").$type(),removeBranding:(0,l.zM)("removeBranding").notNull().default(!1),shared:(0,l.zM)("shared").notNull().default(!1),forkedFromBlockId:(0,s.Qq)("forkedFromBlockId"),isBlocked:(0,l.zM)("isBlocked").default(!1),allowCrawling:(0,l.zM)("allowCrawling"),hasSourceBeenEdited:(0,l.zM)("hasSourceBeenEdited").default(!1),latestDeploymentInfo:(0,d.Fx)("latestDeploymentInfo").$type(),templateVersionId:(0,s.Qq)("templateVersionId"),templateCanonId:(0,s.Qq)("templateCanonId")},e=>{var t;return{chatIdIndex:(0,i.Pe)("blocksChatIdIndex").on(e.chatId),messageIdIndex:(0,i.Pe)("blocksMessageIdIndex").on(e.messageId),createdAtIndex:(0,i.Pe)("blocksCreatedAtIndex").on(e.createdAt),lowerBlockIdIndex:(0,i.Pe)("blockId_lower_idx").on((t=e.blockId,(0,v.ll)(b(),t)))}});(0,g.aJ)(C),(0,h.K1)(C,e=>{let{one:t}=e;return{chat:t(q,{fields:[C.chatId],references:[q.chatId]}),message:t(j,{fields:[C.messageId],references:[j.messageId]}),forkedFromBlock:t(C,{fields:[C.forkedFromBlockId],references:[C.blockId]}),subdomains:t(V),templateVersion:t(R,{fields:[C.templateVersionId],references:[R.templateVersionId]}),template:t(B,{fields:[C.templateCanonId],references:[B.templateCanonId]})}});let S=(0,u.rL)("status",["triage","corrected","external_fix","ignored","pending","assigned","resolved"]),E=(0,u.rL)("type",["upvote","downvote"]),K=(0,o.cJ)("feedback",{type:E("type").default("downvote").notNull(),feedbackId:(0,p.vX)("feedbackId").primaryKey(),messageId:(0,s.Qq)("messageId").notNull().references(()=>j.messageId),leafMessageId:(0,s.Qq)("leafMessageId"),submitterId:(0,s.Qq)("submitterId"),reasons:(0,s.Qq)("reasons").array().notNull(),freeform:(0,s.Qq)("freeform").notNull(),quote:(0,s.Qq)("quote"),status:S("status").default("triage").notNull(),comment:(0,s.Qq)("comment"),createdAt:(0,n.vE)("createdAt").defaultNow().notNull(),updatedAt:(0,n.vE)("updatedAt").defaultNow(),deletedAt:(0,n.vE)("deletedAt"),correctionId:(0,s.Qq)("correctionId"),categories:(0,s.Qq)("categories").array().notNull().default([])});(0,h.K1)(K,e=>{let{one:t}=e;return{message:t(j,{fields:[K.messageId],references:[j.messageId]}),correction:t(M,{fields:[K.correctionId],references:[M.correctionId]})}});let M=(0,o.cJ)("corrections",{correctionId:(0,s.Qq)("correctionId").primaryKey().notNull(),feedbackId:(0,m.nd)("feedbackId"),correctorId:(0,s.Qq)("correctorId"),messageId:(0,s.Qq)("messageId"),prompt:(0,s.Qq)("prompt").notNull(),response:(0,s.Qq)("response").notNull(),promotedBlocks:(0,s.Qq)("promotedBlocks").array().notNull(),suppressedBlocks:(0,s.Qq)("suppressedBlocks").array().notNull(),promotedSources:(0,s.Qq)("promotedSources").array().notNull(),suppressedSources:(0,s.Qq)("suppressedSources").array().notNull(),status:(0,s.Qq)("status").$type().default("unset").notNull(),approvedById:(0,s.Qq)("approvedById"),approvedAt:(0,n.vE)("approvedAt"),rejectionReason:(0,s.Qq)("rejectionReason"),createdAt:(0,n.vE)("createdAt").defaultNow().notNull(),updatedAt:(0,n.vE)("updatedAt").defaultNow(),deletedAt:(0,n.vE)("deletedAt")});(0,h.K1)(M,e=>{let{many:t,one:r}=e;return{feedback:t(K),message:r(j,{fields:[M.messageId],references:[j.messageId]})}});let F=(0,o.cJ)("projectsAndChats",{project:(0,s.Qq)("projectId"),chat:(0,s.Qq)("chatId")},e=>({projectIdx:(0,i.Pe)("project_idx").on(e.project),chatIdx:(0,i.GL)("chat_idx").on(e.chat)}));(0,h.K1)(F,e=>{let{one:t}=e;return{project:t(z,{fields:[F.project],references:[z.projectId]}),chat:t(q,{fields:[F.chat],references:[q.chatId]})}});let P=(0,o.cJ)("messagesAndSources",{message:(0,s.Qq)("messageId"),source:(0,s.Qq)("sourceId")},e=>({messageIdx:(0,i.Pe)("messagesAndSources_message_idx").on(e.message),sourceIdx:(0,i.GL)("messagesAndSources_source_idx").on(e.source)})),J=(0,o.cJ)("chatsAndSources",{chat:(0,s.Qq)("chatId"),source:(0,s.Qq)("sourceId")},e=>({chatIdx:(0,i.Pe)("chatsAndSources_chat_idx").on(e.chat),sourceIdx:(0,i.GL)("chatsAndSources_source_idx").on(e.source)})),T=(0,o.cJ)("projectsAndSources",{project:(0,s.Qq)("projectId"),source:(0,s.Qq)("sourceId")},e=>({projectIdx:(0,i.Pe)("projectsAndSources_project_idx").on(e.project),sourceIdx:(0,i.GL)("projectsAndSources_source_idx").on(e.source)}));(0,h.K1)(P,e=>{let{one:t}=e;return{message:t(j,{fields:[P.message],references:[j.messageId]}),source:t(N,{fields:[P.source],references:[N.sourceId]})}}),(0,h.K1)(J,e=>{let{one:t}=e;return{chat:t(q,{fields:[J.chat],references:[q.chatId]}),source:t(N,{fields:[J.source],references:[N.sourceId]})}}),(0,h.K1)(T,e=>{let{one:t}=e;return{project:t(z,{fields:[T.project],references:[z.projectId]}),source:t(N,{fields:[T.source],references:[N.sourceId]})}});let V=(0,o.cJ)("subdomains",{blockId:(0,s.Qq)("blockId").primaryKey().notNull(),subdomain:(0,s.Qq)("subdomain").notNull().unique()});(0,h.K1)(V,e=>{let{one:t}=e;return{block:t(C,{fields:[V.blockId],references:[C.blockId]})}});let _=(0,o.cJ)("userFavoritedChats",{userId:(0,s.Qq)("userId").notNull(),chatId:(0,s.Qq)("chatId").notNull().references(()=>q.chatId),favoritedAt:(0,n.vE)("favoritedAt").defaultNow().notNull()},e=>({pk:(0,I.ie)({columns:[e.userId,e.chatId]}),chatIdIdx:(0,i.Pe)("userFavoritedChats_chatId_idx").on(e.chatId)}));(0,h.K1)(_,e=>{let{one:t}=e;return{chat:t(q,{fields:[_.chatId],references:[q.chatId]})}});let L=(0,o.cJ)("userFavoritedProjects",{userId:(0,s.Qq)("userId").notNull(),projectId:(0,s.Qq)("projectId").notNull().references(()=>z.projectId),favoritedAt:(0,n.vE)("favoritedAt").defaultNow().notNull()},e=>({pk:(0,I.ie)({columns:[e.userId,e.projectId]}),chatIdIdx:(0,i.Pe)("userFavoritedProjects_projectId_idx").on(e.projectId)}));(0,h.K1)(L,e=>{let{one:t}=e;return{projects:t(z,{fields:[L.projectId],references:[z.projectId]})}}),(0,o.cJ)("integrations",{...x,ownerId:(0,s.Qq)("ownerId").notNull(),creatorId:(0,s.Qq)("creatorId").notNull(),settings:(0,d.Fx)("settings").$type(),accessToken:(0,s.Qq)("accessToken").notNull(),refreshToken:(0,s.Qq)("refreshToken"),tokenExpiresAt:(0,n.vE)("tokenExpiresAt"),integrationUserId:(0,s.Qq)("integrationUserId").notNull(),provider:(0,s.Qq)("provider").$type().notNull()},e=>({pk:(0,I.ie)({columns:[e.provider,e.ownerId,e.creatorId]}),figmaIntegrationUserIdIdx:(0,i.Pe)("integrations_integrationUserId_idx").on(e.integrationUserId)})),(0,o.cJ)("apiKeys",{id:(0,s.Qq)("id").primaryKey(),name:(0,s.Qq)("name").notNull(),hashedKey:(0,s.Qq)("hashedKey").notNull(),partialKey:(0,s.Qq)("partialKey").notNull(),created:(0,n.vE)("createdAt").defaultNow().notNull(),lastUsed:(0,n.vE)("lastUsedAt"),ownerId:(0,s.Qq)("ownerId").notNull(),creatorId:(0,s.Qq)("creatorId").notNull()});let R=(0,o.cJ)("templateVersions",{...x,templateVersionId:(0,s.Qq)("templateVersionId").primaryKey().notNull(),templateCanonId:(0,s.Qq)("templateCanonId").notNull(),blockId:(0,s.Qq)("blockId").notNull(),publishedToCommunity:(0,s.Qq)("templatePublishedToCommunity").$type().default("private"),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),imageUrl:(0,s.Qq)("imageUrl"),envVarKeys:(0,s.Qq)("envVarKeys").array().notNull().default([])},e=>({blockIdIndex:(0,i.Pe)("templatesBlockIdIndex").on(e.blockId),templateCanonIdIndex:(0,i.Pe)("templateCanonId").on(e.blockId)}));(0,g.aJ)(R),(0,h.K1)(R,e=>{let{one:t}=e;return{block:t(C,{fields:[R.blockId],references:[C.blockId]}),templateCanon:t(B,{fields:[R.templateCanonId],references:[B.templateCanonId]})}});let B=(0,o.cJ)("templates",{...x,templateCanonId:(0,s.Qq)("templateCanonId").primaryKey().notNull(),templateVersionId:(0,s.Qq)("templateVersionId").unique().notNull(),authorId:(0,s.Qq)("authorId").notNull()});(0,g.aJ)(B),(0,h.K1)(B,e=>{let{one:t}=e;return{templateVersion:t(R,{fields:[B.templateVersionId],references:[R.templateVersionId]})}})},68163:(e,t,r)=>{r.d(t,{O:()=>n,k:()=>a});let a={messages:[],isLoading:!1,activeForkKey:void 0,isContinuing:!1,isStreaming:!1,isAuthor:!1},n={title:"",isEmpty:!0,isNew:!1,authorId:"",ownerId:""}},66117:(e,t,r)=>{r.d(t,{C1:()=>f,Ir:()=>u,K1:()=>o,Mb:()=>a,RA:()=>c,_z:()=>n,n1:()=>p,pe:()=>d,qQ:()=>s,qR:()=>l});let a=(e,t,r)=>{if(!e)return;let a=e.findIndex(e=>e===t);return a<0?e:[...e.slice(0,a),r]},n=(e,t)=>void 0===e?[t]:[...e,t],o=e=>e&&e.length>0?e[e.length-1]:void 0,s=(e,t)=>e?[...e.slice(0,e.length-1),t]:n(void 0,t),l=(e,t)=>{if(!e)return;let r=e.findIndex(e=>e===t);if(!(r<0))return e[r-1]},d="<ROOT_MESSAGE>";function i(e){let t=new Map;for(let r of e){let e=r.parentId||d;t.set(e,[...t.get(e)||[],r])}return t}function c(e){let t=i(e),r=new Set,a=new Map,o=(e,s)=>{var l;if(e&&r.has(e.id))return;let i=t.get(e?e.id:d);e&&r.add(e.id);let c=[];for(let e=0;e<(null!==(l=null==i?void 0:i.length)&&void 0!==l?l:0);e++){let t=i[e],r=n(s,t.id);c.push(r),o(t,r)}a.set(e?e.id:d,c)};return o(void 0,void 0),a}function u(e,t){let r=i(e),a=new Set,n=[];return!function e(t){if(!a.has(t))for(let o of(a.add(t),r.get(t)||[]))n.push(o.messageId),e(o.messageId)}(t||d),n}function f(e,t){let r=t,a=i(e),s=o(r)||d,l=a.get(s)||[],c=new Set;for(;l.length>0;){let{id:e}=l[0];if(c.has(e))break;c.add(e),r=n(r,e),l=a.get(e)||[]}return r}function p(e,t){let r;let a=i(e),s=e=>{var t,r;let s=new Set,l=null===(t=a.get(e&&o(e)||d))||void 0===t?void 0:t[0],i=e;for(;l&&!s.has(l.messageId);)s.add(l.messageId),i=n(i,l.messageId),l=null===(r=a.get(l.messageId))||void 0===r?void 0:r[0];return i};if(!t)return s();let l=new Set;return!function e(o,s){if(!l.has(o||d))for(let i of(l.add(o||d),a.get(o||d)||[])){let a=n(s,i.messageId);if(i.messageId===t){r=a;return}e(i.messageId,a)}}(void 0,void 0),s(r)}},17978:(e,t,r)=>{r.d(t,{hN:()=>b,jh:()=>k});var a=r(25388),n=r(4126),o=r(9833),s=r(61702);let l=s.z.object({id:s.z.string(),name:s.z.string(),url:s.z.string(),content:s.z.string().optional(),status:s.z.enum(["uploading","done"]).optional(),size:s.z.number(),isImage:s.z.boolean(),isSavedDraft:s.z.boolean().optional(),v0Type:o.bZ,tokens:s.z.number().optional(),contentType:s.z.string().optional()}),d="new-chat-prompt-draft",i=s.z.object({version:s.z.literal(1),drafts:s.z.record(s.z.string(),s.z.object({message:s.z.string(),isMessageTrimmed:s.z.boolean().optional(),isExpandedDraft:s.z.boolean().optional(),quote:s.z.string().optional(),inputHeight:s.z.number().optional(),localFileInfos:s.z.array(l),fileMap:s.z.record(s.z.string(),s.z.object({name:s.z.string().optional(),contentType:s.z.string().optional(),url:s.z.string(),size:s.z.number(),isSavedDraft:s.z.boolean().optional(),v0Type:o.bZ})),updatedAt:s.z.number()}))});var c=r(96541),u=r(80612),f=r(62841),p=r(90761),m=r(73927),I=r(38651);let g="chat-prompt-drafts",h=e=>({version:1,drafts:{[e]:{message:"",localFileInfos:[],fileMap:{},updatedAt:Date.now()}}});function v(e){let t=JSON.parse(JSON.stringify(e));for(let e in t.drafts){for(let r of(t.drafts[e].fileMap={},t.drafts[e].localFileInfos))delete r.content;if(t.drafts[e].localFileInfos=t.drafts[e].localFileInfos.slice(0,3),t.drafts[e].message){let r=t.drafts[e].message.length>=100;t.drafts[e].isMessageTrimmed=r,t.drafts[e].message=r?"":t.drafts[e].message}t.drafts[e].quote&&(t.drafts[e].quote=t.drafts[e].quote.slice(0,200))}a.A.set(n.kK,JSON.stringify(t),{expires:n.Cy})}let y=e=>{let t;let{chatId:r,newData:a}=e,n=r||d,o=localStorage.getItem(g);try{if((t=i.parse(JSON.parse(o||"{}"))).drafts[n]||(t.drafts[n]=h(n).drafts[n]),Object.keys(t.drafts).length>6){let{minKey:e,minValue:r}={minKey:"",minValue:1/0};for(let a in t.drafts)a!==d&&a!==n&&t.drafts[a].updatedAt<r&&(e=a,r=t.drafts[a].updatedAt);e&&delete t.drafts[e]}}catch(e){t=h(n)}t.drafts[n]={...t.drafts[n],...a},t.drafts[n].updatedAt=Date.now();try{localStorage.setItem(g,JSON.stringify(t)),v(t)}catch(e){var s,l;(0,I.u)("PromptDraftSaveError",{errorMsg:e instanceof Error?e.message:String(e),messageLength:null===(s=a.message)||void 0===s?void 0:s.length,quoteLength:null===(l=a.quote)||void 0===l?void 0:l.length})}},b=e=>{let t;let{chatId:r}=e,o=localStorage.getItem(g);try{t=i.parse(JSON.parse(o||"{}")),delete t.drafts[r||d],localStorage.setItem(g,JSON.stringify(t)),v(t)}catch(e){localStorage.removeItem(g),a.A.remove(n.kK)}},x=e=>{let t=e||d,r=localStorage.getItem(g);try{let e=i.parse(JSON.parse(r||"{}"));v(e);let a=e.drafts[t];if(!a)return v(e),null;return{...a,source:"localStorage",key:t}}catch(e){return a.A.remove(n.kK),localStorage.removeItem(g),null}};function k(){let{chatId:e}=(0,f.xz)(),{isEmpty:t}=(0,p.tZ)(),r=(0,m.usePathname)(),{data:a,mutate:n}=(0,u.Ay)(["chat:drafts",t?null:e]);return(0,c.useEffect)(()=>{if((null==a?void 0:a.source)==="cookie"){let r=x(t?void 0:e);n(r?{...r,isExpandedDraft:a.isMessageTrimmed}:null)}},[a,n,t,e]),{setDraft:n,draft:a,handleSavePromptDraft:(0,c.useCallback)(a=>{r.startsWith("/chat/projects")||y({chatId:t?void 0:e,newData:a})},[t,e,r])}}},90761:(e,t,r)=>{r.d(t,{dW:()=>c,kM:()=>u,sC:()=>i,tZ:()=>d});var a=r(80612),n=r(62841),o=r(96541),s=r(68163),l=r(17978);function d(){let{chatId:e}=(0,n.xz)(),{data:t,mutate:r}=(0,a.Ay)(["chat:meta",e]),l=(0,o.useRef)(null!=t?t:s.O);return{setMetadata:(0,o.useCallback)(e=>r(t=>({...null!=t?t:l.current,...e})),[r]),...null!=t?t:s.O}}function i(){let{chatId:e}=(0,n.xz)(),{handleSavePromptDraft:t}=(0,l.jh)(),{data:r,mutate:s}=(0,a.Ay)(["chat:quote",e]);return{quote:r,setQuote:(0,o.useCallback)(e=>{s(e),t({quote:e||void 0})},[s])}}function c(){let{chatId:e}=(0,n.xz)(),{data:t,mutate:r}=(0,a.Ay)(["chat:shareable",e]);return{shareable:t,setShareable:r}}function u(){let{chatId:e}=(0,n.xz)(),{data:t,mutate:r}=(0,a.Ay)(["chat:privacy",e]);return{chatPrivacy:t,setChatPrivacy:r}}},62841:(e,t,r)=>{r.d(t,{Pk:()=>f,jo:()=>u,xz:()=>c});var a=r(80612),n=r(56847),o=r(96541),s=r(68163),l=r(5697),d=r(73927);let i=["/chat/internal","/chat/projects","/chat/upgrade","/chat/explore","/chat/block-subdomain","/chat/blocks","/chat/history"];function c(){let{data:e,mutate:t}=(0,a.Ay)("chat:id"),r=(0,d.usePathname)();return(0,o.useEffect)(()=>{i.includes(r)&&t(void 0,!1)},[r,t]),{chatId:e}}function u(){let{chatId:e}=c(),{saveLeafMessageId:t,cacheForkKey:r}=(0,l.f)(),{mutate:a}=(0,n.iX)();return(0,o.useCallback)(n=>{a(["chat:state",e],a=>{let o=null!=a?a:s.k;return(o.activeForkKey&&r(o.activeForkKey),"function"==typeof n)?{...o,...n(o)}:(n.activeForkKey&&n.saveLeafMessageId&&e&&(delete n.saveLeafMessageId,t({chatId:e,activeForkKey:n.activeForkKey})),{...o,...n})})},[e,a,r,t])}function f(){let{chatId:e}=c(),{data:t}=(0,a.Ay)(["chat:state",e]);return{...null!=t?t:s.k,chatId:null!=e?e:"something_went_wrong"}}},5697:(e,t,r)=>{r.d(t,{f:()=>c});var a=r(66117),n=r(64480),o=r(80612),s=r(62841),l=r(96541);let d={};async function i(e,t){let{arg:r}=t,n=(0,a.K1)(r.activeForkKey);if(n)return fetch(e,{method:"POST",body:JSON.stringify({chatId:r.chatId,messageId:n})}).then(e=>e.json())}function c(){let{chatId:e}=(0,s.xz)(),{trigger:t}=(0,n.A)("/chat/api/chat/leaf",i),{data:r,mutate:a}=(0,o.Ay)(["chat:leaf:cache",e],null),c=(0,l.useCallback)(e=>{a(t=>{if(!e)return t;let r=!1,a={...t||d};for(let t of e)a[t]!==e&&(a[t]=e,r=!0);return r?a:t})},[a]),u=(0,l.useCallback)(e=>{let{chatId:r,activeForkKey:a}=e;r&&t({chatId:r,activeForkKey:a})},[c,t]);return{cacheForkKey:c,saveLeafMessageId:u,forkKeyCache:r||d,switchForkKey:c}}}}]);